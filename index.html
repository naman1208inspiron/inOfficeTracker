<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Office Time Tracker</title>
    <meta name="theme-color" content="#21808d">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Office Timer">
    <link rel="apple-touch-icon"
        href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 192 192'%3E%3Crect fill='%2321808d' width='192' height='192'/%3E%3Cpath fill='%23fcfcf9' d='M104 48c-13.3 0-24 10.7-24 24v48c0 13.3 10.7 24 24 24h16c13.3 0 24-10.7 24-24V72c0-13.3-10.7-24-24-24H88zm0 16h8v8h-8v-8zm0 24h8v40h-8V88z'/%3E%3C/svg%3E">
    <link rel="manifest" href="/manifest.json">

    <style>
        :root {
            --color-white: rgba(255, 255, 255, 1);
            --color-black: rgba(0, 0, 0, 1);
            --color-cream-50: rgba(252, 252, 249, 1);
            --color-cream-100: rgba(255, 255, 253, 1);
            --color-gray-200: rgba(245, 245, 245, 1);
            --color-gray-300: rgba(167, 169, 169, 1);
            --color-gray-400: rgba(119, 124, 124, 1);
            --color-slate-500: rgba(98, 108, 113, 1);
            --color-brown-600: rgba(94, 82, 64, 1);
            --color-charcoal-700: rgba(31, 33, 33, 1);
            --color-charcoal-800: rgba(38, 40, 40, 1);
            --color-slate-900: rgba(19, 52, 59, 1);
            --color-teal-300: rgba(50, 184, 198, 1);
            --color-teal-400: rgba(45, 166, 178, 1);
            --color-teal-500: rgba(33, 128, 141, 1);
            --color-teal-600: rgba(29, 116, 128, 1);
            --color-teal-700: rgba(26, 104, 115, 1);
            --color-brown-600-rgb: 94, 82, 64;
            --color-teal-500-rgb: 33, 128, 141;
            --color-slate-900-rgb: 19, 52, 59;
            --color-background: var(--color-cream-50);
            --color-surface: var(--color-cream-100);
            --color-text: var(--color-slate-900);
            --color-text-secondary: var(--color-slate-500);
            --color-primary: var(--color-teal-500);
            --color-primary-hover: var(--color-teal-600);
            --color-primary-active: var(--color-teal-700);
            --color-secondary: rgba(var(--color-brown-600-rgb), 0.12);
            --color-secondary-hover: rgba(var(--color-brown-600-rgb), 0.2);
            --color-border: rgba(var(--color-brown-600-rgb), 0.2);
            --color-btn-primary-text: var(--color-cream-50);
            --color-card-border: rgba(var(--color-brown-600-rgb), 0.12);
            --font-family-base: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            --font-size-sm: 12px;
            --font-size-base: 14px;
            --font-size-lg: 16px;
            --font-size-xl: 18px;
            --font-size-2xl: 20px;
            --font-size-3xl: 24px;
            --font-size-4xl: 30px;
            --font-weight-normal: 400;
            --font-weight-medium: 500;
            --font-weight-semibold: 550;
            --font-weight-bold: 600;
            --space-8: 8px;
            --space-12: 12px;
            --space-16: 16px;
            --space-20: 20px;
            --space-24: 24px;
            --space-32: 32px;
            --radius-base: 8px;
            --radius-md: 10px;
            --radius-lg: 12px;
            --radius-full: 9999px;
            --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.04), 0 1px 2px rgba(0, 0, 0, 0.02);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.04), 0 2px 4px -1px rgba(0, 0, 0, 0.02);
            --duration-normal: 250ms;
            --ease-standard: cubic-bezier(0.16, 1, 0.3, 1);
        }

        @media (prefers-color-scheme: dark) {
            :root {
                --color-gray-400-rgb: 119, 124, 124;
                --color-teal-300-rgb: 50, 184, 198;
                --color-gray-300-rgb: 167, 169, 169;
                --color-gray-200-rgb: 245, 245, 245;
                --color-background: var(--color-charcoal-700);
                --color-surface: var(--color-charcoal-800);
                --color-text: var(--color-gray-200);
                --color-text-secondary: rgba(var(--color-gray-300-rgb), 0.7);
                --color-primary: var(--color-teal-300);
                --color-primary-hover: var(--color-teal-400);
                --color-secondary: rgba(var(--color-gray-400-rgb), 0.15);
                --color-secondary-hover: rgba(var(--color-gray-400-rgb), 0.25);
                --color-border: rgba(var(--color-gray-400-rgb), 0.3);
                --color-btn-primary-text: var(--color-slate-900);
                --color-card-border: rgba(var(--color-gray-400-rgb), 0.2);
            }
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-family-base);
            background-color: var(--color-background);
            color: var(--color-text);
            -webkit-font-smoothing: antialiased;
            padding-bottom: 70px;
            min-height: 100vh;
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
            padding: var(--space-20);
        }

        .header {
            text-align: center;
            margin-bottom: var(--space-32);
            padding-top: var(--space-16);
        }

        .header h1 {
            font-size: var(--font-size-3xl);
            font-weight: var(--font-weight-bold);
            color: var(--color-text);
            margin-bottom: var(--space-8);
        }

        .header p {
            font-size: var(--font-size-base);
            color: var(--color-text-secondary);
        }

        .card {
            background-color: var(--color-surface);
            border-radius: var(--radius-lg);
            border: 1px solid var(--color-card-border);
            box-shadow: var(--shadow-sm);
            padding: var(--space-24);
            margin-bottom: var(--space-20);
        }

        .date-display {
            text-align: center;
            font-size: 24px !important;
            color: var(--color-text-secondary);
            margin-bottom: var(--space-24);
            font-weight: var(--font-weight-medium);
        }

        .mode-selector {
            display: flex;
            gap: var(--space-12);
            margin-bottom: var(--space-24);
        }

        .mode-btn {
            flex: 1;
            padding: var(--space-16);
            border-radius: var(--radius-md);
            border: 2px solid var(--color-border);
            background: var(--color-surface);
            color: var(--color-text);
            font-size: var(--font-size-base);
            font-weight: var(--font-weight-medium);
            cursor: pointer;
            transition: all var(--duration-normal) var(--ease-standard);
        }

        .mode-btn:hover {
            background: var(--color-secondary);
            border-color: var(--color-primary);
        }

        .mode-btn.active {
            background: var(--color-primary);
            border-color: var(--color-primary);
            color: var(--color-btn-primary-text);
        }

        .timer-section {
            text-align: center;
        }

        .timer-display {
            font-size: var(--font-size-4xl);
            font-weight: var(--font-weight-bold);
            color: var(--color-primary);
            margin: var(--space-24) 0;
            font-variant-numeric: tabular-nums;
        }

        .time-info {
            margin: var(--space-16) 0;
            padding: var(--space-16);
            background: var(--color-secondary);
            border-radius: var(--radius-base);
        }

        .time-info p {
            margin-bottom: var(--space-8);
            font-size: var(--font-size-base);
            color: var(--color-text-secondary);
        }

        .time-info p:last-child {
            margin-bottom: 0;
        }

        .time-info strong {
            color: var(--color-text);
        }

        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: var(--space-12) var(--space-32);
            border-radius: var(--radius-base);
            font-size: var(--font-size-base);
            font-weight: var(--font-weight-medium);
            cursor: pointer;
            transition: all var(--duration-normal) var(--ease-standard);
            border: none;
            width: 100%;
        }

        .btn-primary {
            background: var(--color-primary);
            color: var(--color-btn-primary-text);
        }

        .btn-primary:hover {
            background: var(--color-primary-hover);
        }

        .btn-secondary {
            background: var(--color-secondary);
            color: var(--color-text);
            margin-top: var(--space-12);
        }

        .btn-secondary:hover {
            background: var(--color-secondary-hover);
        }

        .wfh-message {
            text-align: center;
            padding: var(--space-32);
        }

        .wfh-message h3 {
            font-size: var(--font-size-xl);
            margin-bottom: var(--space-12);
            color: var(--color-text);
        }

        .wfh-message p {
            color: var(--color-text-secondary);
        }

        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--color-surface);
            border-top: 1px solid var(--color-card-border);
            display: flex;
            justify-content: space-around;
            padding: var(--space-12) 0;
            box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.05);
        }

        .nav-item {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            padding: var(--space-8);
            color: var(--color-text-secondary);
            cursor: pointer;
            border: none;
            background: none;
            transition: color var(--duration-normal) var(--ease-standard);
        }

        .nav-item.active {
            color: var(--color-primary);
        }

        .nav-icon {
            font-size: 24px;
        }

        .nav-label {
            font-size: var(--font-size-sm);
            font-weight: var(--font-weight-medium);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .week-selector {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--space-24);
        }

        .week-nav-btn {
            background: var(--color-secondary);
            border: none;
            padding: var(--space-8) var(--space-16);
            border-radius: var(--radius-base);
            color: var(--color-text);
            cursor: pointer;
            font-size: var(--font-size-base);
            font-weight: var(--font-weight-medium);
        }

        .week-nav-btn:hover {
            background: var(--color-secondary-hover);
        }

        .week-range {
            font-weight: var(--font-weight-semibold);
            color: var(--color-text);
        }

        .day-log {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--space-16);
            border-bottom: 1px solid var(--color-card-border);
            cursor: pointer;
            transition: background var(--duration-normal);
        }

        .day-log:hover {
            background: var(--color-secondary);
        }

        .day-log:last-child {
            border-bottom: none;
        }

        .day-info {
            flex: 1;
        }

        .day-name {
            font-weight: var(--font-weight-semibold);
            color: var(--color-text);
            margin-bottom: 4px;
        }

        .day-date {
            font-size: var(--font-size-sm);
            color: var(--color-text-secondary);
        }

        .day-hours {
            font-weight: var(--font-weight-bold);
            color: var(--color-primary);
            font-size: var(--font-size-lg);
        }

        .wfh-badge {
            background: var(--color-secondary);
            padding: 4px var(--space-12);
            border-radius: var(--radius-full);
            font-size: var(--font-size-sm);
            color: var(--color-text-secondary);
            font-weight: var(--font-weight-medium);
        }

        .insight-item {
            padding: var(--space-12);
            margin-bottom: var(--space-12);
            background: var(--color-secondary);
            border-radius: var(--radius-base);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .insight-label {
            color: var(--color-text);
            font-weight: var(--font-weight-medium);
        }

        .insight-value {
            font-weight: var(--font-weight-bold);
            color: var(--color-primary);
        }

        .insight-value.warning {
            color: #ff6b6b;
        }

        .insight-value.success {
            color: var(--color-primary);
        }

        .holiday-badge {
            background: #ff6b6b;
            color: white;
            padding: 4px var(--space-12);
            border-radius: var(--radius-full);
            font-size: var(--font-size-sm);
            font-weight: var(--font-weight-medium);
        }

        .hidden {
            display: none !important;
        }

        .mode-selector {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: var(--space-12);
            margin-bottom: var(--space-24);
        }

        .mode-selector .mode-btn:last-child {
            grid-column: 1 / -1;
        }

        .warning-msg {
            background: #fff3cd;
            color: #856404;
            padding: var(--space-12);
            border-radius: var(--radius-base);
            margin: var(--space-16) 0;
            text-align: center;
        }

        /* Modal styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.6);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: var(--space-20);
        }

        .modal {
            background: var(--color-surface);
            border-radius: var(--radius-lg);
            padding: var(--space-24);
            max-width: 500px;
            width: 100%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        .modal h3 {
            margin-bottom: var(--space-20);
            color: var(--color-text);
        }

        .form-group {
            margin-bottom: var(--space-16);
        }

        .form-label {
            display: block;
            margin-bottom: var(--space-8);
            font-weight: var(--font-weight-medium);
            font-size: var(--font-size-sm);
            color: var(--color-text);
        }

        .form-input {
            width: 100%;
            padding: var(--space-12);
            border: 1px solid var(--color-border);
            border-radius: var(--radius-base);
            font-size: var(--font-size-base);
            font-family: var(--font-family-base);
            background: var(--color-background);
            color: var(--color-text);
        }

        .form-input:focus {
            outline: none;
            border-color: var(--color-primary);
        }

        .modal-buttons {
            display: flex;
            gap: var(--space-12);
            margin-top: var(--space-24);
        }

        .fun-message {
            text-align: center;
            padding: var(--space-32);
            font-size: var(--font-size-lg);
            line-height: 1.6;
        }

        .fun-message h3 {
            font-size: var(--font-size-2xl);
            margin-bottom: var(--space-16);
        }

        .edit-times-section {
            margin-top: var(--space-16);
            padding: var(--space-16);
            background: var(--color-background);
            border-radius: var(--radius-base);
        }

        .edit-times-section h4 {
            font-size: var(--font-size-base);
            margin-bottom: var(--space-12);
            color: var(--color-text);
        }
    </style>
</head>

<body>
    <!-- Today Tab -->
    <div id="today-tab" class="tab-content active">
        <div class="container">
            <div class="header">
                <h1>Office Time Tracker</h1>
                <p class="date-display" id="current-date"></p>
            </div>

            <div id="mode-selection" class="card">
                <h3 style="margin-bottom: var(--space-16); font-size: var(--font-size-lg);">Where are you working today?
                </h3>
                <div class="mode-selector">
                    <button class="mode-btn" id="wfh-btn">üè† Work From Home</button>
                    <button class="mode-btn" id="office-btn">üíº Office</button>
                    <button class="mode-btn" id="holiday-btn">üèñÔ∏è Holiday - hurrah!!</button>
                </div>
            </div>

            <div id="wfh-screen" class="card hidden">
                <div class="wfh-message">
                    <h3>‚úÖ Marked as WFH</h3>
                    <p>This day has been logged as Work From Home</p>
                    <button class="btn btn-secondary" id="back-from-wfh-btn">‚Üê Back to Options</button>
                </div>
            </div>

            <div id="office-screen" class="card hidden">
                <div class="timer-section">
                    <h3 style="margin-bottom: var(--space-16); font-size: var(--font-size-lg);">Office Time</h3>

                    <!-- Before Login -->
                    <div id="before-login">
                        <p style="margin-bottom: var(--space-16); color: var(--color-text-secondary);">Record your login
                            time to start tracking</p>
                        <button class="btn btn-primary" id="record-login-btn">üïê Record Login Time</button>
                        <button class="btn btn-secondary" id="back-from-office-btn">‚Üê Back to Options</button>
                    </div>

                    <!-- After Login -->
                    <div id="after-login" class="hidden">
                        <div class="time-info">
                            <p><strong>Login Time:</strong> <span id="login-time-display"></span></p>
                            <p><strong>Logout Time:</strong> <span id="logout-time-display">Not recorded</span></p>
                        </div>

                        <div class="timer-display" id="elapsed-time-display">00:00:00</div>

                        <div id="warning-container"></div>

                        <button class="btn btn-primary" id="record-logout-btn">üïê Record Logout Time</button>

                        <!-- Edit Times Section -->
                        <div class="edit-times-section">
                            <h4>üï∞Ô∏è Edit Times (if you forgot to record)</h4>
                            <div class="form-group">
                                <label class="form-label">Login Time (Today only)</label>
                                <input type="time" id="edit-login-input" class="form-input">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Logout Time (Today only)</label>
                                <input type="time" id="edit-logout-input" class="form-input">
                            </div>

                            <button class="btn btn-primary" id="save-custom-times-btn">üíæ Save Custom Times</button>
                        </div>

                        <button class="btn btn-secondary" id="reset-day-btn">Reset Day</button>
                    </div>
                </div>
            </div>

            <div id="holiday-screen" class="card hidden">
                <div class="wfh-message">
                    <h3>üèñÔ∏è Holiday Logged - Enjoy!!!</h3>
                    <p>8 hours automatically logged as office time</p>
                    <button class="btn btn-secondary" id="uncheck-holiday-btn">Uncheck Holiday</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Analytics Tab -->
    <div id="analytics-tab" class="tab-content">
        <div class="container">
            <div class="header">
                <h1>Analytics</h1>
                <p>Track your office hours</p>
            </div>

            <div class="week-selector">
                <button class="week-nav-btn" id="prev-week">‚Üê Previous</button>
                <span class="week-range" id="week-range"></span>
                <button class="week-nav-btn" id="next-week">Next ‚Üí</button>
            </div>


            <!-- Future Week Message -->
            <div id="future-week-message" class="card hidden">
                <div class="fun-message" id="fun-content"></div>
            </div>

            <!-- Regular Analytics -->
            <div id="analytics-content">
                <div class="card">
                    <h3 style="margin-bottom: var(--space-16); font-size: var(--font-size-lg);">Weekly Compliance</h3>
                    <div id="weekly-insights"></div>
                </div>

                <div class="card">
                    <h3 style="margin-bottom: var(--space-16); font-size: var(--font-size-lg);">Daily Breakdown</h3>
                    <div id="daily-logs"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Day Modal -->
    <div id="edit-day-modal" class="modal-overlay hidden">
        <div class="modal">
            <h3>Edit Day</h3>
            <div id="edit-day-date"></div>

            <div class="form-group">
                <label class="form-label">Mode</label>
                <select id="edit-mode-select" class="form-input">
                    <option value="office">Office</option>
                    <option value="wfh">Work From Home</option>
                    <option value="holiday">Holiday</option>
                </select>
            </div>

            <div id="edit-office-times">
                <div class="form-group">
                    <label class="form-label">Login Time</label>
                    <input type="datetime-local" id="edit-day-login-input" class="form-input">
                </div>
                <div class="form-group">
                    <label class="form-label">Logout Time</label>
                    <input type="datetime-local" id="edit-day-logout-input" class="form-input">
                </div>
            </div>

            <div class="modal-buttons">
                <button class="btn btn-primary" id="save-day-edit-btn" style="flex: 1;">üíæ Save</button>
                <button class="btn btn-secondary" id="delete-day-btn" style="flex: 1; margin-top: 0;">üóëÔ∏è
                    Delete</button>
                <button class="btn btn-secondary" id="cancel-edit-btn" style="flex: 1; margin-top: 0;">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Bottom Navigation -->
    <nav class="bottom-nav">
        <button class="nav-item active" id="nav-today">
            <span class="nav-icon">üìÖ</span>
            <span class="nav-label">Today</span>
        </button>
        <button class="nav-item" id="nav-analytics">
            <span class="nav-icon">üìä</span>
            <span class="nav-label">Analytics</span>
        </button>
    </nav>

    <script>
        // State management
        let updateInterval = null;
        let currentWeekOffset = 0;
        let editingDayKey = null;

        // Fun messages for future weeks
        const funMessages = [
            // Office Jokes
            { type: 'joke', text: 'ü§î Boss: "Why are you late?"\nMe: "I was logging yesterday\'s hours!"' },
            { type: 'joke', text: 'üòÑ My favorite exercise at work? Running out of coffee!' },
            { type: 'joke', text: 'üíº "I love deadlines. I love the whooshing noise they make as they go by." - Douglas Adams' },
            { type: 'joke', text: '‚òï Coffee: Because adulting is hard and Mondays are harder!' },
            { type: 'joke', text: 'üòÇ I told my boss 3 people at work were slacking. He said, "Who?" I said, "Me, Myself, and I."' },
            { type: 'joke', text: 'üè¢ Why don\'t scientists trust atoms at work? Because they make up everything!' },
            { type: 'joke', text: '‚è∞ I\'m not saying I\'m Wonder Woman, I\'m just saying no one has ever seen me and Wonder Woman in the office at the same time.' },

            // Dad Jokes
            { type: 'joke', text: 'üòÑ Why did the scarecrow get promoted? He was outstanding in his field!' },
            { type: 'joke', text: 'ü§ì What do you call a bear with no teeth? A gummy bear!' },
            { type: 'joke', text: 'üòÇ I used to hate facial hair, but then it grew on me.' },
            { type: 'joke', text: 'üéØ Why don\'t eggs tell jokes? They\'d crack each other up!' },
            { type: 'joke', text: 'üì± What did the janitor say when he jumped out of the closet? SUPPLIES!' },
            { type: 'joke', text: '‚å®Ô∏è Why did the computer go to therapy? It had too many tabs open!' },

            // Future Week Specific
            { type: 'joke', text: 'ü§î Trying to predict the future? Even weather apps can\'t do that!' },
            { type: 'joke', text: 'üòÑ Time machine under maintenance. Please work on present week!' },
            { type: 'joke', text: '‚è∞ Error 404: Future data not found. Try working today instead!' },
            { type: 'joke', text: 'üöÄ Future weeks are like flying cars - we all want them, but they don\'t exist yet!' },
            { type: 'joke', text: 'üîÆ Crystal ball says: Focus on THIS week first!' },
            { type: 'joke', text: 'üìÖ Slow down there, Marty McFly! Let\'s finish this week first!' },

            // Motivational Quotes
            { type: 'quote', text: 'üí° "The future depends on what you do today." - Mahatma Gandhi' },
            { type: 'quote', text: 'üåü "Focus on being productive instead of busy." - Tim Ferriss' },
            { type: 'quote', text: '‚ú® "The best time to plant a tree was 20 years ago. The second best time is now."' },
            { type: 'quote', text: 'üí™ "Success is the sum of small efforts repeated day in and day out." - Robert Collier' },
            { type: 'quote', text: 'üéØ "The only way to do great work is to love what you do." - Steve Jobs' },
            { type: 'quote', text: 'üöÄ "Don\'t watch the clock; do what it does. Keep going." - Sam Levenson' },
            { type: 'quote', text: '‚≠ê "Start where you are. Use what you have. Do what you can." - Arthur Ashe' },
            { type: 'quote', text: 'üí´ "Your limitation‚Äîit\'s only your imagination."' },

            // Pahelis
            { type: 'paheli', text: 'üß© Paheli: Aisa kon sa time hai jo kabhi nahi aata?\n\nAnswer: Next week! üòâ' },
            { type: 'paheli', text: 'ü§î Paheli: Woh kaun si cheez hai jo sirf dekhne ke liye hoti hai, use nahi kar sakte?\n\nAnswer: Future week ka data! üòÑ' },
            { type: 'paheli', text: 'üéØ Paheli: Kal aayega par kabhi nahi aata, woh kya hai?\n\nAnswer: Kal! Focus on aaj! üòä' },
            { type: 'paheli', text: 'üß† Paheli: Office mein sabse zyada kya chalta hai?\n\nAnswer: AC! üòÇ' },
            { type: 'paheli', text: 'ü§∑ Paheli: Woh kaunsa din hai jab sab log busy dikhte hain par kaam nahi hota?\n\nAnswer: Monday! üò¥' }
        ];

        // Data storage structure
        let appData = {
            logs: {}
        };

        // Initialize app
        function init() {
            loadData();
            updateCurrentDate();
            checkTodayLog();
            setupEventListeners();
        }

        // Load data from localStorage
        function loadData() {
            try {
                const stored = localStorage.getItem('officeTimeTrackerData');
                if (stored) {
                    appData = JSON.parse(stored);
                }
            } catch (e) {
                console.error('Error loading data:', e);
            }
        }

        // Save data to localStorage
        function saveData() {
            try {
                localStorage.setItem('officeTimeTrackerData', JSON.stringify(appData));
            } catch (e) {
                console.error('Error saving data:', e);
            }
        }

        // Get today's date in YYYY-MM-DD format
        function getTodayKey() {
            const today = new Date();
            return today.toISOString().split('T')[0];
        }

        // Format date for display
        function formatDate(date) {
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            return date.toLocaleDateString('en-IN', options);
        }

        // Format time for display (HH:MM AM/PM)
        function formatTimeDisplay(timestamp) {
            const date = new Date(timestamp);
            return date.toLocaleTimeString('en-IN', { hour: '2-digit', minute: '2-digit', hour12: true });
        }

        // Format timestamp to datetime-local input value
        function formatDateTimeLocal(timestamp) {
            const date = new Date(timestamp);
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            const hours = String(date.getHours()).padStart(2, '0');
            const minutes = String(date.getMinutes()).padStart(2, '0');
            return `${year}-${month}-${day}T${hours}:${minutes}`;
        }

        // Format seconds to HH:MM:SS
        function formatTime(seconds) {
            const h = Math.floor(seconds / 3600);
            const m = Math.floor((seconds % 3600) / 60);
            const s = seconds % 60;
            return `${String(h).padStart(2, '0')}:${String(m).padStart(2, '0')}:${String(s).padStart(2, '0')}`;
        }

        // Format seconds to Xh Ym
        function formatHoursMinutes(seconds) {
            const h = Math.floor(seconds / 3600);
            const m = Math.floor((seconds % 3600) / 60);
            return `${h}h ${m}m`;
        }

        // Update current date display
        function updateCurrentDate() {
            const today = new Date();
            document.getElementById('current-date').textContent = formatDate(today);
        }

        // Calculate elapsed time from login
        function calculateElapsedTime(loginTime, logoutTime) {
            const endTime = logoutTime || Date.now();
            return Math.floor((endTime - loginTime) / 1000);
        }

        // Update elapsed time display (CHANGED: Now updates every second)
        function updateElapsedTimeDisplay() {
            const todayKey = getTodayKey();
            const todayLog = appData.logs[todayKey];

            if (todayLog && todayLog.loginTime) {
                const elapsed = calculateElapsedTime(todayLog.loginTime, todayLog.logoutTime);
                document.getElementById('elapsed-time-display').textContent = formatTime(elapsed);

                // Update warning
                const warningContainer = document.getElementById('warning-container');
                if (todayLog.logoutTime) {
                    const hours = elapsed / 3600;
                    if (hours < 8) {
                        warningContainer.innerHTML = `<div class="warning-msg">‚ö†Ô∏è Total time is ${formatHoursMinutes(elapsed)} - less than 8 hours. You can record a new logout time.</div>`;
                    } else {
                        warningContainer.innerHTML = '';
                    }
                } else {
                    warningContainer.innerHTML = '';
                }
            }
        }

        // Record login time
        function recordLogin() {
            const todayKey = getTodayKey();
            const now = Date.now();

            appData.logs[todayKey] = {
                mode: 'office',
                loginTime: now,
                logoutTime: null
            };
            saveData();

            // Show after-login screen
            document.getElementById('before-login').classList.add('hidden');
            document.getElementById('after-login').classList.remove('hidden');

            // Display login time
            document.getElementById('login-time-display').textContent = formatTimeDisplay(now);
            document.getElementById('logout-time-display').textContent = 'Not recorded';

            // Set time inputs (HH:MM format)
            const nowDate = new Date(now);
            document.getElementById('edit-login-input').value = `${String(nowDate.getHours()).padStart(2, '0')}:${String(nowDate.getMinutes()).padStart(2, '0')}`;
            document.getElementById('edit-logout-input').value = '';


            // Start updating display EVERY SECOND (CHANGED from 60000 to 1000)
            updateElapsedTimeDisplay();
            if (updateInterval) clearInterval(updateInterval);
            updateInterval = setInterval(updateElapsedTimeDisplay, 1000);
        }

        // Record logout time
        function recordLogout() {
            const todayKey = getTodayKey();
            const todayLog = appData.logs[todayKey];

            if (todayLog && todayLog.loginTime) {
                const now = Date.now();
                todayLog.logoutTime = now;
                saveData();

                // Display logout time
                document.getElementById('logout-time-display').textContent = formatTimeDisplay(now);
                const logoutDate = new Date(now);
                document.getElementById('edit-logout-input').value = `${String(logoutDate.getHours()).padStart(2, '0')}:${String(logoutDate.getMinutes()).padStart(2, '0')}`;


                // Update display immediately
                updateElapsedTimeDisplay();

                // Keep updating even after logout (user can see time and may want to change logout time)
                // Don't stop interval - let it keep updating in case user wants real-time view
            }
        }

        // Save custom times
        function saveCustomTimes() {
            const todayKey = getTodayKey();
            const todayLog = appData.logs[todayKey];

            if (todayLog) {
                const loginInput = document.getElementById('edit-login-input').value;
                const logoutInput = document.getElementById('edit-logout-input').value;
                const now = Date.now();

                if (loginInput) {
                    // Parse time and apply to today's date
                    const [hours, minutes] = loginInput.split(':');
                    const loginDate = new Date();
                    loginDate.setHours(parseInt(hours), parseInt(minutes), 0, 0);
                    const loginTimestamp = loginDate.getTime();

                    // Check if login time is in future
                    if (loginTimestamp > now) {
                        alert('‚ùå Login time cannot be in the future!');
                        return;
                    }

                    todayLog.loginTime = loginTimestamp;
                    document.getElementById('login-time-display').textContent = formatTimeDisplay(loginTimestamp);
                }

                if (logoutInput) {
                    // Parse time and apply to today's date
                    const [hours, minutes] = logoutInput.split(':');
                    const logoutDate = new Date();
                    logoutDate.setHours(parseInt(hours), parseInt(minutes), 0, 0);
                    const logoutTimestamp = logoutDate.getTime();

                    // Check if logout time is in future
                    if (logoutTimestamp > now) {
                        alert('‚ùå Logout time cannot be in the future!');
                        return;
                    }

                    // Check if logout is before login
                    if (todayLog.loginTime && logoutTimestamp < todayLog.loginTime) {
                        alert('‚ùå Logout time cannot be before login time!');
                        return;
                    }

                    todayLog.logoutTime = logoutTimestamp;
                    document.getElementById('logout-time-display').textContent = formatTimeDisplay(logoutTimestamp);
                } else {
                    todayLog.logoutTime = null;
                    document.getElementById('logout-time-display').textContent = 'Not recorded';
                }

                saveData();
                updateElapsedTimeDisplay();
                alert('‚úÖ Times updated successfully!');
            }
        }


        // Reset day
        function resetDay() {
            const todayKey = getTodayKey();
            delete appData.logs[todayKey];
            saveData();

            if (updateInterval) {
                clearInterval(updateInterval);
                updateInterval = null;
            }

            showModeSelection();
        }

        // Check if today already has a log
        function checkTodayLog() {
            const todayKey = getTodayKey();
            const todayLog = appData.logs[todayKey];

            if (todayLog) {
                if (todayLog.mode === 'wfh') {
                    showWFHScreen();
                } else if (todayLog.mode === 'office') {
                    showOfficeScreen();

                    if (todayLog.loginTime) {
                        // Show after-login screen
                        document.getElementById('before-login').classList.add('hidden');
                        document.getElementById('after-login').classList.remove('hidden');

                        // Display times
                        document.getElementById('login-time-display').textContent = formatTimeDisplay(todayLog.loginTime);
                        const loginDate = new Date(todayLog.loginTime);
                        document.getElementById('edit-login-input').value = `${String(loginDate.getHours()).padStart(2, '0')}:${String(loginDate.getMinutes()).padStart(2, '0')}`;

                        if (todayLog.logoutTime) {
                            document.getElementById('logout-time-display').textContent = formatTimeDisplay(todayLog.logoutTime);
                            const logoutDate = new Date(todayLog.logoutTime);
                            document.getElementById('edit-logout-input').value = `${String(logoutDate.getHours()).padStart(2, '0')}:${String(logoutDate.getMinutes()).padStart(2, '0')}`;
                        } else {
                            document.getElementById('logout-time-display').textContent = 'Not recorded';
                            document.getElementById('edit-logout-input').value = '';
                            // Start updating if not logged out (CHANGED: every 1 second)
                            if (updateInterval) clearInterval(updateInterval);
                            updateInterval = setInterval(updateElapsedTimeDisplay, 1000);
                        }

                        // Update display
                        updateElapsedTimeDisplay();
                    }
                } else if (todayLog.mode === 'holiday') {
                    showHolidayScreen();
                }
            } else {
                showModeSelection();
            }
        }

        // Show mode selection
        function showModeSelection() {
            document.getElementById('mode-selection').classList.remove('hidden');
            document.getElementById('wfh-screen').classList.add('hidden');
            document.getElementById('office-screen').classList.add('hidden');
            document.getElementById('holiday-screen').classList.add('hidden');
        }

        // Show WFH screen
        function showWFHScreen() {
            document.getElementById('mode-selection').classList.add('hidden');
            document.getElementById('wfh-screen').classList.remove('hidden');
            document.getElementById('office-screen').classList.add('hidden');
            document.getElementById('holiday-screen').classList.add('hidden');

            const todayKey = getTodayKey();
            appData.logs[todayKey] = { mode: 'wfh' };
            saveData();
        }

        // Show office screen
        function showOfficeScreen() {
            document.getElementById('mode-selection').classList.add('hidden');
            document.getElementById('wfh-screen').classList.add('hidden');
            document.getElementById('office-screen').classList.remove('hidden');
            document.getElementById('holiday-screen').classList.add('hidden');

            const todayKey = getTodayKey();
            if (!appData.logs[todayKey]) {
                // Show before-login
                document.getElementById('before-login').classList.remove('hidden');
                document.getElementById('after-login').classList.add('hidden');
            }
        }

        // Show holiday screen
        function showHolidayScreen() {
            document.getElementById('mode-selection').classList.add('hidden');
            document.getElementById('wfh-screen').classList.add('hidden');
            document.getElementById('office-screen').classList.add('hidden');
            document.getElementById('holiday-screen').classList.remove('hidden');

            const todayKey = getTodayKey();
            appData.logs[todayKey] = {
                mode: 'holiday',
                loginTime: new Date().setHours(9, 0, 0, 0),
                logoutTime: new Date().setHours(17, 0, 0, 0)
            };
            saveData();
        }

        // Get week date range
        function getWeekRange(offset = 0) {
            const today = new Date();
            const currentDay = today.getDay();
            const monday = new Date(today);
            monday.setDate(today.getDate() - currentDay + (currentDay === 0 ? -6 : 1) + (offset * 7));

            const sunday = new Date(monday);
            sunday.setDate(monday.getDate() + 6);

            return { monday, sunday };
        }

        // Get dates in week
        function getDatesInWeek(offset = 0) {
            const { monday } = getWeekRange(offset);
            const dates = [];

            for (let i = 0; i < 7; i++) {
                const date = new Date(monday);
                date.setDate(monday.getDate() + i);
                dates.push(date);
            }

            return dates;
        }

        // Check if week is in future
        function isWeekInFuture(offset) {
            const { monday } = getWeekRange(offset);
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            return monday > today;
        }

        // Get random fun message
        function getRandomFunMessage() {
            return funMessages[Math.floor(Math.random() * funMessages.length)];
        }

        // Update analytics view
        function updateAnalytics() {
            // Check if future week
            if (isWeekInFuture(currentWeekOffset)) {
                document.getElementById('future-week-message').classList.remove('hidden');
                document.getElementById('analytics-content').classList.add('hidden');

                // HIDE next button when on future week
                document.getElementById('next-week').style.display = 'none';

                const funMsg = getRandomFunMessage();
                const emoji = funMsg.type === 'joke' ? 'üòÑ' : funMsg.type === 'quote' ? 'üí°' : 'üß©';
                document.getElementById('fun-content').innerHTML = `
                    <h3>${emoji} ${funMsg.type === 'joke' ? 'Time Travel Alert!' : funMsg.type === 'quote' ? 'Words of Wisdom' : 'Paheli Time!'}</h3>
                    <p>${funMsg.text}</p>
                `;
                return;
            }

            // Show regular analytics and SHOW next button
            document.getElementById('future-week-message').classList.add('hidden');
            document.getElementById('analytics-content').classList.remove('hidden');
            document.getElementById('next-week').style.display = 'block';

            const { monday, sunday } = getWeekRange(currentWeekOffset);
            const dates = getDatesInWeek(currentWeekOffset);

            // Update week range
            const weekRangeText = `${monday.getDate()} ${monday.toLocaleString('en-IN', { month: 'short' })} - ${sunday.getDate()} ${sunday.toLocaleString('en-IN', { month: 'short' })} ${sunday.getFullYear()}`;
            document.getElementById('week-range').textContent = weekRangeText;

            // Calculate metrics
            let officeDays8Plus = 0;
            let wfhDays = 0;
            let holidayDays = 0;

            dates.forEach(date => {
                const key = date.toISOString().split('T')[0];
                const log = appData.logs[key];
                if (log) {
                    if (log.mode === 'office' && log.loginTime) {
                        const elapsed = calculateElapsedTime(log.loginTime, log.logoutTime);
                        if (elapsed >= 8 * 3600) {
                            officeDays8Plus++;
                        }
                    } else if (log.mode === 'holiday') {
                        officeDays8Plus++;
                        holidayDays++;
                    } else if (log.mode === 'wfh') {
                        wfhDays++;
                    }
                }
            });

            // Update weekly insights
            updateWeeklyInsights(officeDays8Plus, wfhDays, holidayDays, dates);

            // Update daily logs
            const dailyLogsContainer = document.getElementById('daily-logs');
            dailyLogsContainer.innerHTML = '';

            dates.forEach(date => {
                const key = date.toISOString().split('T')[0];
                const log = appData.logs[key];

                // Skip Saturday (6) and Sunday (0)
                const dayOfWeek = date.getDay();
                if (dayOfWeek === 0 || dayOfWeek === 6) {
                    return;
                }

                const dayLog = document.createElement('div');
                dayLog.className = 'day-log';
                dayLog.onclick = () => openEditDayModal(key, date);

                const dayInfo = document.createElement('div');
                dayInfo.className = 'day-info';

                const dayName = document.createElement('div');
                dayName.className = 'day-name';
                dayName.textContent = date.toLocaleDateString('en-IN', { weekday: 'long' });

                const dayDate = document.createElement('div');
                dayDate.className = 'day-date';
                dayDate.textContent = date.toLocaleDateString('en-IN', { month: 'short', day: 'numeric', year: 'numeric' });

                dayInfo.appendChild(dayName);
                dayInfo.appendChild(dayDate);

                const dayHours = document.createElement('div');

                if (!log) {
                    dayHours.className = 'day-hours';
                    dayHours.textContent = '-';
                    dayHours.style.color = 'var(--color-text-secondary)';
                } else if (log.mode === 'wfh') {
                    dayHours.className = 'wfh-badge';
                    dayHours.textContent = 'WFH';
                } else if (log.mode === 'holiday') {
                    dayHours.className = 'day-hours';
                    dayHours.innerHTML = '8h 0m <span class="holiday-badge" style="margin-left: 8px; font-size: 10px;">üèñÔ∏è</span>';
                } else if (log.mode === 'office' && log.loginTime) {
                    const elapsed = calculateElapsedTime(log.loginTime, log.logoutTime);
                    dayHours.className = 'day-hours';
                    dayHours.textContent = formatHoursMinutes(elapsed);
                } else {
                    dayHours.className = 'day-hours';
                    dayHours.textContent = '-';
                    dayHours.style.color = 'var(--color-text-secondary)';
                }

                dayLog.appendChild(dayInfo);
                dayLog.appendChild(dayHours);
                dailyLogsContainer.appendChild(dayLog);
            });
        }

        // Update weekly insights
        function updateWeeklyInsights(officeDays8Plus, wfhDays, holidayDays, dates) {
            const insightsContainer = document.getElementById('weekly-insights');
            insightsContainer.innerHTML = '';

            const requiredOfficeDays = 3;
            const maxWfhDays = 2;
            const remainingOfficeDays = Math.max(0, requiredOfficeDays - officeDays8Plus);

            const today = new Date();
            const todayInWeek = dates.findIndex(date => date.toDateString() === today.toDateString());
            const remainingDaysInWeek = Math.max(0, 6 - todayInWeek);

            // Office compliance
            const officeInsight = document.createElement('div');
            officeInsight.className = 'insight-item';
            officeInsight.innerHTML = `
                <span class="insight-label">Office Days (8+ hrs)</span>
                <span class="insight-value ${officeDays8Plus >= requiredOfficeDays ? 'success' : 'warning'}">${officeDays8Plus}/${requiredOfficeDays}</span>
            `;
            insightsContainer.appendChild(officeInsight);

            // WFH compliance
            const wfhInsight = document.createElement('div');
            wfhInsight.className = 'insight-item';
            wfhInsight.innerHTML = `
                <span class="insight-label">WFH Days used</span>
                <span class="insight-value ${wfhDays <= maxWfhDays ? 'success' : 'warning'}">${wfhDays}/${maxWfhDays}</span>
            `;
            insightsContainer.appendChild(wfhInsight);

            // Holiday days
            if (holidayDays > 0) {
                const holidayInsight = document.createElement('div');
                holidayInsight.className = 'insight-item';
                holidayInsight.innerHTML = `
                    <span class="insight-label">Holiday Days</span>
                    <span class="insight-value">${holidayDays}</span>
                `;
                insightsContainer.appendChild(holidayInsight);
            }

            // Status
            const recommendationInsight = document.createElement('div');
            recommendationInsight.className = 'insight-item';
            let recommendation = '';
            let recommendationClass = 'success';

            if (remainingOfficeDays > 0) {
                if (remainingOfficeDays > remainingDaysInWeek) {
                    recommendation = `Need ${remainingOfficeDays} more days`;
                    recommendationClass = 'warning';
                } else {
                    recommendation = `${remainingOfficeDays} more WFO needed`;
                    recommendationClass = 'warning';
                }
            } else {
                recommendation = '‚úÖ Completed!';
                recommendationClass = 'success';
            }

            recommendationInsight.innerHTML = `
                <span class="insight-label">Status</span>
                <span class="insight-value ${recommendationClass}">${recommendation}</span>
            `;
            insightsContainer.appendChild(recommendationInsight);
        }

        // Open edit day modal
        function openEditDayModal(key, date) {
            editingDayKey = key;
            const log = appData.logs[key];

            document.getElementById('edit-day-date').textContent = formatDate(date);

            if (log) {
                document.getElementById('edit-mode-select').value = log.mode;

                if (log.mode === 'office' && log.loginTime) {
                    document.getElementById('edit-day-login-input').value = formatDateTimeLocal(log.loginTime);
                    if (log.logoutTime) {
                        document.getElementById('edit-day-logout-input').value = formatDateTimeLocal(log.logoutTime);
                    } else {
                        document.getElementById('edit-day-logout-input').value = '';
                    }
                    document.getElementById('edit-office-times').classList.remove('hidden');
                } else {
                    document.getElementById('edit-office-times').classList.add('hidden');
                }
            } else {
                document.getElementById('edit-mode-select').value = 'office';
                document.getElementById('edit-day-login-input').value = '';
                document.getElementById('edit-day-logout-input').value = '';
                document.getElementById('edit-office-times').classList.remove('hidden');
            }

            document.getElementById('edit-day-modal').classList.remove('hidden');
        }

        // Close edit day modal
        function closeEditDayModal() {
            document.getElementById('edit-day-modal').classList.add('hidden');
            editingDayKey = null;
        }

        // Save day edit
        function saveDayEdit() {
            if (!editingDayKey) return;

            const mode = document.getElementById('edit-mode-select').value;

            if (mode === 'wfh') {
                appData.logs[editingDayKey] = { mode: 'wfh' };
            } else if (mode === 'holiday') {
                const date = new Date(editingDayKey);
                appData.logs[editingDayKey] = {
                    mode: 'holiday',
                    loginTime: date.setHours(9, 0, 0, 0),
                    logoutTime: date.setHours(17, 0, 0, 0)
                };
            } else if (mode === 'office') {
                const loginInput = document.getElementById('edit-day-login-input').value;
                const logoutInput = document.getElementById('edit-day-logout-input').value;

                if (loginInput) {
                    appData.logs[editingDayKey] = {
                        mode: 'office',
                        loginTime: new Date(loginInput).getTime(),
                        logoutTime: logoutInput ? new Date(logoutInput).getTime() : null
                    };
                } else {
                    alert('Please enter a login time for office mode');
                    return;
                }
            }

            saveData();
            updateAnalytics();
            closeEditDayModal();
        }

        // Delete day
        function deleteDay() {
            if (!editingDayKey) return;

            if (confirm('Are you sure you want to delete this day\'s record?')) {
                delete appData.logs[editingDayKey];
                saveData();
                updateAnalytics();
                closeEditDayModal();
            }
        }

        // Setup event listeners
        function setupEventListeners() {
            // Mode selection
            document.getElementById('wfh-btn').addEventListener('click', showWFHScreen);
            document.getElementById('office-btn').addEventListener('click', showOfficeScreen);
            document.getElementById('holiday-btn').addEventListener('click', showHolidayScreen);

            // Office screen
            document.getElementById('record-login-btn').addEventListener('click', recordLogin);
            document.getElementById('record-logout-btn').addEventListener('click', recordLogout);
            document.getElementById('save-custom-times-btn').addEventListener('click', saveCustomTimes);
            document.getElementById('reset-day-btn').addEventListener('click', resetDay);

            // Holiday screen
            document.getElementById('uncheck-holiday-btn').addEventListener('click', () => {
                const todayKey = getTodayKey();
                delete appData.logs[todayKey];
                saveData();
                showModeSelection();
            });

            // Back buttons
            document.getElementById('back-from-office-btn').addEventListener('click', () => {
                const todayKey = getTodayKey();
                delete appData.logs[todayKey];
                saveData();
                if (updateInterval) {
                    clearInterval(updateInterval);
                    updateInterval = null;
                }
                showModeSelection();
            });

            document.getElementById('back-from-wfh-btn').addEventListener('click', () => {
                const todayKey = getTodayKey();
                delete appData.logs[todayKey];
                saveData();
                showModeSelection();
            });

            // Edit day modal
            document.getElementById('save-day-edit-btn').addEventListener('click', saveDayEdit);
            document.getElementById('delete-day-btn').addEventListener('click', deleteDay);
            document.getElementById('cancel-edit-btn').addEventListener('click', closeEditDayModal);

            document.getElementById('edit-mode-select').addEventListener('change', (e) => {
                if (e.target.value === 'office') {
                    document.getElementById('edit-office-times').classList.remove('hidden');
                } else {
                    document.getElementById('edit-office-times').classList.add('hidden');
                }
            });

            // Bottom navigation
            document.getElementById('nav-today').addEventListener('click', () => {
                document.getElementById('today-tab').classList.add('active');
                document.getElementById('analytics-tab').classList.remove('active');
                document.getElementById('nav-today').classList.add('active');
                document.getElementById('nav-analytics').classList.remove('active');
            });

            document.getElementById('nav-analytics').addEventListener('click', () => {
                document.getElementById('today-tab').classList.remove('active');
                document.getElementById('analytics-tab').classList.add('active');
                document.getElementById('nav-today').classList.remove('active');
                document.getElementById('nav-analytics').classList.add('active');
                updateAnalytics();
            });

            // Week navigation
            document.getElementById('prev-week').addEventListener('click', () => {
                currentWeekOffset--;
                updateAnalytics();
            });

            document.getElementById('next-week').addEventListener('click', () => {
                currentWeekOffset++;
                updateAnalytics();
            });
        }

        // Initialize app on load
        init();
    </script>
</body>

</html>